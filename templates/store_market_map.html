<!DOCTYPE html>
<html>
<head>
  <title>Store → Market Mapping</title>
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- jQuery + Select2 -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet"/>
  <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
</head>

<body class="bg-gray-100 p-8">
  <header class="flex justify-between items-center mb-6">
    <h1 class="text-3xl font-bold">Store → Market Mapping</h1>
    <div>
      <span id="userEmail" class="mr-4 font-semibold"></span>
      <button onclick="logout()"
        class="px-4 py-2 bg-gray-700 text-white rounded">
        Logout
      </button>
    </div>
  </header>

  <section class="bg-white p-6 rounded shadow mb-8">
    <h2 class="text-xl font-bold mb-4">Assign Store</h2>
    <table class="w-full border">
      <thead>
        <tr class="bg-gray-200 text-left">
          <th class="p-3">Store</th>
          <th class="p-3">Market</th>
          <th class="p-3">Save</th>
        </tr>
      </thead>
      <tbody id="storeTable"></tbody>
    </table>
  </section>


  <div class="bg-white p-6 rounded shadow mt-8">
    <h2 class="text-xl font-bold mb-4">Current Store → Market Mappings</h2>
  
    <table class="w-full border text-sm">
      <thead>
        <tr class="bg-gray-200 text-left">
          <th class="p-3 border">Store</th>
          <th class="p-3 border">Market</th>
          <th class="p-3 border">Updated By</th>
          <th class="p-3 border">Updated At</th>
          <th class="p-3 border">Actions</th>
        </tr>
      </thead>
  
      <tbody id="mappingTableBody"></tbody>
    </table>
  </div>

  <script type="module" src="/static/js/store-market-map.js"></script>

  <!-- <script>
    window.userRole="admin"; //TODO: remove this after firebase authentication

    // --------- FIREBASE CONFIG -----------
    const firebaseConfig = {
      apiKey: "AIzaSyDiBf4C4K5uoK_PS_kpMtaHLUvxnKLytF0",
      authDomain: "zoom-shops-dev.firebaseapp.com",
      databaseURL: "https://zoom-shops-dev.firebaseio.com",
      projectId: "zoom-shops-dev",
      storageBucket: "zoom-shops-dev.appspot.com",
      messagingSenderId: "664912892527",
      appId: "1:664912892527:web:d38c1d6f14f311ab",
      measurementId: "G-TDJME6Q1L1"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    let idToken = null;  // store JWT token

    document.getElementById("loginBtn").onclick = () => {
      alert("auth");
      const provider = new firebase.auth.GoogleAuthProvider();
      auth.signInWithPopup(provider);
    };

    auth.onAuthStateChanged(async (user) => {
      if (user) {
        idToken = await user.getIdToken();
        document.getElementById("userEmail").innerText = user.email;

        // show main app
        document.getElementById("loginDiv").classList.add("hidden");
        document.getElementById("appDiv").classList.remove("hidden");

        loadData();
      } else {
        // show login
        document.getElementById("loginDiv").classList.remove("hidden");
        document.getElementById("appDiv").classList.add("hidden");
      }
    });

    function logout() {
      auth.signOut();
    }

    // --------- FETCH DATA WITH AUTH TOKEN -----------
    async function authFetch(url, options = {}) {
      const headers = options.headers || {};
      headers["Authorization"] = "Bearer " + idToken;

      return fetch(url, { ...options, headers });
    }

    loadData();
    loadCurrentMappings();
  </script> -->
</body>
</html>
